{"ast":null,"code":"import React,{useState,useEffect,useCallback}from'react';import{executeMove,initializeGameState,undoMove,calculateCoverage}from'../utils/GameLogic';import GameBoard from'./GameBoard';import GameControls from'./GameControls';import GameInfo from'./GameInfo';import GameScore from'./GameScore';import'./Game.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Game=_ref=>{let{level,onLevelComplete,onLevelFailed}=_ref;const[gameState,setGameState]=useState(()=>initializeGameState(level));const[isAnimating,setIsAnimating]=useState(false);// 重置遊戲\nconst resetGame=useCallback(()=>{setGameState(initializeGameState(level));setIsAnimating(false);},[level]);// 執行移動\nconst handleMove=useCallback(direction=>{if(isAnimating||gameState.isGameWon||gameState.isGameLost){return;}setIsAnimating(true);// 添加移動動畫延遲\nsetTimeout(()=>{const newGameState=executeMove(gameState,direction);setGameState(newGameState);setIsAnimating(false);},150);},[gameState,isAnimating]);// 撤銷移動\nconst handleUndo=useCallback(()=>{if(isAnimating||gameState.moveHistory.length<=1){return;}const newGameState=undoMove(gameState);setGameState(newGameState);},[gameState,isAnimating]);// 提示功能（簡單實現）\nconst handleHint=useCallback(()=>{// 簡單的提示：顯示未覆蓋的格子\nconst coverage=calculateCoverage(gameState);alert(\"\\u76EE\\u524D\\u8986\\u84CB\\u7387: \".concat(coverage,\"%\\n\\u7E7C\\u7E8C\\u79FB\\u52D5\\u65B9\\u584A\\u4F86\\u8986\\u84CB\\u6240\\u6709\\u683C\\u5B50\\uFF01\"));},[gameState]);// 鍵盤事件處理\nuseEffect(()=>{const handleKeyPress=event=>{if(isAnimating||gameState.isGameWon||gameState.isGameLost){return;}switch(event.key){case'ArrowUp':case'w':case'W':event.preventDefault();handleMove('up');break;case'ArrowDown':case's':case'S':event.preventDefault();handleMove('down');break;case'ArrowLeft':case'a':case'A':event.preventDefault();handleMove('left');break;case'ArrowRight':case'd':case'D':event.preventDefault();handleMove('right');break;case'z':case'Z':event.preventDefault();handleUndo();break;case'r':case'R':event.preventDefault();resetGame();break;case'h':case'H':event.preventDefault();handleHint();break;}};window.addEventListener('keydown',handleKeyPress);return()=>window.removeEventListener('keydown',handleKeyPress);},[handleMove,handleUndo,resetGame,handleHint,isAnimating,gameState.isGameWon,gameState.isGameLost]);// 遊戲狀態變化處理\nuseEffect(()=>{if(gameState.isGameWon&&onLevelComplete){onLevelComplete(gameState);}else if(gameState.isGameLost&&onLevelFailed){onLevelFailed(gameState);}},[gameState.isGameWon,gameState.isGameLost,onLevelComplete,onLevelFailed,gameState]);// 當關卡改變時重置遊戲\nuseEffect(()=>{resetGame();},[level.id,resetGame]);const canUndo=gameState.moveHistory.length>1;const isGameActive=!gameState.isGameWon&&!gameState.isGameLost;return/*#__PURE__*/_jsxs(\"div\",{className:\"game-container\",children:[/*#__PURE__*/_jsx(GameScore,{gameState:gameState}),/*#__PURE__*/_jsxs(\"div\",{className:\"game-content-2048\",children:[/*#__PURE__*/_jsx(GameBoard,{gameState:gameState,onCellClick:position=>{// 可以添加點擊格子的功能\nconsole.log('Clicked cell:',position);}}),/*#__PURE__*/_jsx(GameControls,{onMove:handleMove,onUndo:handleUndo,onReset:resetGame,onHint:handleHint,canUndo:canUndo,isGameActive:isGameActive}),/*#__PURE__*/_jsx(\"div\",{className:\"game-info-compact\",children:/*#__PURE__*/_jsx(GameInfo,{gameState:gameState})})]}),isAnimating&&/*#__PURE__*/_jsx(\"div\",{className:\"animation-overlay\"})]});};export default Game;","map":{"version":3,"names":["React","useState","useEffect","useCallback","executeMove","initializeGameState","undoMove","calculateCoverage","GameBoard","GameControls","GameInfo","GameScore","jsx","_jsx","jsxs","_jsxs","Game","_ref","level","onLevelComplete","onLevelFailed","gameState","setGameState","isAnimating","setIsAnimating","resetGame","handleMove","direction","isGameWon","isGameLost","setTimeout","newGameState","handleUndo","moveHistory","length","handleHint","coverage","alert","concat","handleKeyPress","event","key","preventDefault","window","addEventListener","removeEventListener","id","canUndo","isGameActive","className","children","onCellClick","position","console","log","onMove","onUndo","onReset","onHint"],"sources":["/Users/arthurlin/Desktop/網服/wp1141/hw2/src/components/Game.tsx"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport { GameState, Level, Direction } from '../types/GameTypes';\nimport { executeMove, initializeGameState, undoMove, calculateCoverage } from '../utils/GameLogic';\nimport GameBoard from './GameBoard';\nimport GameControls from './GameControls';\nimport GameInfo from './GameInfo';\nimport GameScore from './GameScore';\nimport './Game.css';\n\ninterface GameProps {\n  level: Level;\n  onLevelComplete?: (gameState: GameState) => void;\n  onLevelFailed?: (gameState: GameState) => void;\n}\n\nconst Game: React.FC<GameProps> = ({ level, onLevelComplete, onLevelFailed }) => {\n  const [gameState, setGameState] = useState<GameState>(() => initializeGameState(level));\n  const [isAnimating, setIsAnimating] = useState(false);\n\n  // 重置遊戲\n  const resetGame = useCallback(() => {\n    setGameState(initializeGameState(level));\n    setIsAnimating(false);\n  }, [level]);\n\n  // 執行移動\n  const handleMove = useCallback((direction: Direction) => {\n    if (isAnimating || gameState.isGameWon || gameState.isGameLost) {\n      return;\n    }\n\n    setIsAnimating(true);\n    \n    // 添加移動動畫延遲\n    setTimeout(() => {\n      const newGameState = executeMove(gameState, direction);\n      setGameState(newGameState);\n      setIsAnimating(false);\n    }, 150);\n  }, [gameState, isAnimating]);\n\n  // 撤銷移動\n  const handleUndo = useCallback(() => {\n    if (isAnimating || gameState.moveHistory.length <= 1) {\n      return;\n    }\n\n    const newGameState = undoMove(gameState);\n    setGameState(newGameState);\n  }, [gameState, isAnimating]);\n\n  // 提示功能（簡單實現）\n  const handleHint = useCallback(() => {\n    // 簡單的提示：顯示未覆蓋的格子\n    const coverage = calculateCoverage(gameState);\n    alert(`目前覆蓋率: ${coverage}%\\n繼續移動方塊來覆蓋所有格子！`);\n  }, [gameState]);\n\n  // 鍵盤事件處理\n  useEffect(() => {\n    const handleKeyPress = (event: KeyboardEvent) => {\n      if (isAnimating || gameState.isGameWon || gameState.isGameLost) {\n        return;\n      }\n\n      switch (event.key) {\n        case 'ArrowUp':\n        case 'w':\n        case 'W':\n          event.preventDefault();\n          handleMove('up');\n          break;\n        case 'ArrowDown':\n        case 's':\n        case 'S':\n          event.preventDefault();\n          handleMove('down');\n          break;\n        case 'ArrowLeft':\n        case 'a':\n        case 'A':\n          event.preventDefault();\n          handleMove('left');\n          break;\n        case 'ArrowRight':\n        case 'd':\n        case 'D':\n          event.preventDefault();\n          handleMove('right');\n          break;\n        case 'z':\n        case 'Z':\n          event.preventDefault();\n          handleUndo();\n          break;\n        case 'r':\n        case 'R':\n          event.preventDefault();\n          resetGame();\n          break;\n        case 'h':\n        case 'H':\n          event.preventDefault();\n          handleHint();\n          break;\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyPress);\n    return () => window.removeEventListener('keydown', handleKeyPress);\n  }, [handleMove, handleUndo, resetGame, handleHint, isAnimating, gameState.isGameWon, gameState.isGameLost]);\n\n  // 遊戲狀態變化處理\n  useEffect(() => {\n    if (gameState.isGameWon && onLevelComplete) {\n      onLevelComplete(gameState);\n    } else if (gameState.isGameLost && onLevelFailed) {\n      onLevelFailed(gameState);\n    }\n  }, [gameState.isGameWon, gameState.isGameLost, onLevelComplete, onLevelFailed, gameState]);\n\n  // 當關卡改變時重置遊戲\n  useEffect(() => {\n    resetGame();\n  }, [level.id, resetGame]);\n\n  const canUndo = gameState.moveHistory.length > 1;\n  const isGameActive = !gameState.isGameWon && !gameState.isGameLost;\n\n  return (\n    <div className=\"game-container\">\n      <GameScore gameState={gameState} />\n      \n      <div className=\"game-content-2048\">\n        <GameBoard \n          gameState={gameState}\n          onCellClick={(position) => {\n            // 可以添加點擊格子的功能\n            console.log('Clicked cell:', position);\n          }}\n        />\n        \n        <GameControls\n          onMove={handleMove}\n          onUndo={handleUndo}\n          onReset={resetGame}\n          onHint={handleHint}\n          canUndo={canUndo}\n          isGameActive={isGameActive}\n        />\n        \n        <div className=\"game-info-compact\">\n          <GameInfo gameState={gameState} />\n        </div>\n      </div>\n      \n      {isAnimating && <div className=\"animation-overlay\" />}\n    </div>\n  );\n};\n\nexport default Game;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}